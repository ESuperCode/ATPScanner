<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Ideal Temp Calculator for the Artifact Transport Pod</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f6f7f9; --panel:#ffffff; --muted:#6f7780; --accent:#0a84ff; --accent2:#0066d6; --shadow:0 10px 30px rgba(16,24,40,0.08); --radius:18px;
  --safe-top:env(safe-area-inset-top,16px);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;background:var(--bg);-webkit-font-smoothing:antialiased;color:#071426 z-index:1000}
#bgCanvas{position:fixed;inset:0;z-index:0}
.app{position:relative;z-index:2;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:calc(var(--safe-top) + 16px) 16px 16px}
.header{width:100%;max-width:980px;display:flex;align-items:center;gap:12px;margin-bottom:12px}
.title{font-weight:700;color:var(--accent);font-size:20px;margin:0}
.subtitle{margin:0;color:var(--muted);font-size:13px}
.container{width:100%;max-width:980px;display:grid;grid-template-columns:1fr 360px;gap:18px}
@media(max-width:980px){.container{grid-template-columns:1fr}}
.card{background:var(--panel);border-radius:18px;box-shadow:var(--shadow);padding:12px;border:1px solid rgba(16,24,40,0.03)}
.fullcam{position:relative;border-radius:14px;overflow:hidden;height:78vh;min-height:520px;background:#061426;display:flex;align-items:stretch;flex-direction:column}
@media(max-width:680px){.fullcam{height:70vh;min-height:380px}}
#video{width:100%;height:100%;object-fit:cover}
.topbar{position:absolute;left:16px;top:16px;padding:8px 12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.03));color:#fff;backdrop-filter:blur(8px);display:flex;align-items:center;gap:10px}
.grid{position:absolute;inset:0;pointer-events:none;display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr)}
.grid>div{border:1px solid rgba(255,255,255,0.02)}
.controls{display:flex;gap:12px;align-items:center;justify-content:center;padding:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01))}
.btn{background:transparent;border:none;padding:10px 12px;border-radius:12px;color:var(--muted);font-weight:700;cursor:pointer}
.shutter{width:96px;height:96px;border-radius:50%;display:grid;place-items:center;background:linear-gradient(180deg,#fff,#f2f6fb);border:6px solid rgba(16,24,40,0.06);cursor:pointer}
.shutterInner{width:64px;height:64px;border-radius:50%;background:linear-gradient(180deg,var(--accent),var(--accent2));display:grid;place-items:center;color:white;font-weight:800;font-size:18px}
.sidebar{display:flex;flex-direction:column;gap:12px;height:100%}
.status{padding:12px;border-radius:12px;background:linear-gradient(180deg,#ffffff,#fbfdff);border:1px solid rgba(16,24,40,0.03)}
.material{display:flex;justify-content:space-between;align-items:center;gap:8px}
.material .label{color:var(--muted);font-size:13px}
.material .value{font-weight:800;color:#071426;font-size:16px}
.progress{height:10px;background:rgba(0,0,0,0.04);border-radius:999px;overflow:hidden}
.progress>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%;transition:width 420ms ease}
.resultCard{padding:12px;border-radius:12px;background:linear-gradient(180deg,#ffffff,#fbfdff);border:1px solid rgba(16,24,40,0.03)}
.preview{border-radius:10px;overflow:hidden;background:#081a20;height:180px}
.preview canvas{width:100%;height:100%;display:block;object-fit:cover;transform:scaleX(-1)}
.uploadBtn{padding:10px 12px;border-radius:12px;background:var(--accent);color:white;border:none;font-weight:700;cursor:pointer}
.note{font-size:12px;color:var(--muted);margin-top:8px}
.footer{margin-top:14px;font-size:12px;color:var(--muted)}
.small{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<canvas id="bgCanvas"></canvas>
<div class="app" id="app">
  <div class="header">
    <div>      
      <p class="subtitle"></p>
    </div>
  </div>

  <div class="container">
    <div class="card fullcam" id="camCard">
      <div class="topbar" id="topbar"><div id="statusText">loading model…</div></div>
      <div style="position:relative;flex:1;display:flex">
        <video id="video" autoplay playsinline></video>
        <canvas id="proc" style="display:none"></canvas>
        <div class="grid" aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
      </div>
      <div class="controls">
        <button class="btn" id="flipBtn">Flip</button>
        <div class="shutter" id="shutterBtn" aria-label="capture"><div class="shutterInner">●</div></div>
        <label for="fileInput" class="btn uploadBtn">Upload</label>
        <input id="fileInput" type="file" accept="image/*" style="display:none"/>
      </div>
    </div>

    <aside class="sidebar">
      <div class="status">
        <div class="material"><div class="label">Material</div><div class="value" id="materialVal">Waiting</div></div>
        <div style="height:10px;margin-top:12px" class="progress"><i id="progBar"></i></div>
        <div class="small" id="stepInfo"></div>
      </div>

      <div class="resultCard" id="resultCard" style="display:none">
        <div class="material" style="margin-bottom:8px"><div class="label">Predicted</div><div class="value" id="predicted">—</div></div>
        <div class="material" style="margin-bottom:12px"><div class="label">Ideal temp</div><div class="value" id="idealTemp">— °F</div></div>
        <div class="small" id="reason">Reason: highest score</div>
      </div>

      <div class="card">
        <div class="preview" style="display: none"><canvas id="previewCanvas"></canvas></div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="saveBtn" class="uploadBtn">Save Photo</button>
        </div>
        <div class="note"></div>
      </div>

    </aside>
  </div>

  
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<script>
const MODEL_BASE = 'https://teachablemachine.withgoogle.com/models/3c-f9atJY/';
const MODEL_JSON = MODEL_BASE + 'model.json';
const METADATA_JSON = MODEL_BASE + 'metadata.json';
let tmModel = null;
let maxPred = null;
const video = document.getElementById('video');
const proc = document.getElementById('proc');
const previewCanvas = document.getElementById('previewCanvas');
const shutterBtn = document.getElementById('shutterBtn');
const flipBtn = document.getElementById('flipBtn');
const fileInput = document.getElementById('fileInput');
const saveBtn = document.getElementById('saveBtn');
const statusText = document.getElementById('statusText');
const progBar = document.getElementById('progBar');
const stepInfo = document.getElementById('stepInfo');
const materialVal = document.getElementById('materialVal');
const resultCard = document.getElementById('resultCard');
const predicted = document.getElementById('predicted');
const idealTemp = document.getElementById('idealTemp');
const reasonEl = document.getElementById('reason');
let stream = null;
function setProg(v){progBar.style.width=Math.max(0,Math.min(100,v))+'%'}
async function startCamera(facingMode='environment'){if(stream){stream.getTracks().forEach(t=>t.stop());stream=null}try{stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:facingMode},audio:false});video.srcObject = stream;await video.play();stepInfo.textContent='Camera ready';}catch(e){stepInfo.textContent='Camera unavailable'} }
async function loadModel(){try{statusText.textContent='Loading model';setProg(12);tmModel = await tmImage.load(MODEL_JSON, METADATA_JSON);setProg(72);statusText.textContent='Model ready';await new Promise(r=>setTimeout(r,300));setProg(100);setTimeout(()=>setProg(0),250)}catch(e){statusText.textContent='Model load failed';console.error(e);alert('Model failed to load — check console for details')} }
function drawToCanvas(src,canvas){const sw = src.videoWidth || src.naturalWidth || src.width; const sh = src.videoHeight || src.naturalHeight || src.height; const size = Math.min(sw,sh); canvas.width = 224; canvas.height = 224; const ctx = canvas.getContext('2d'); ctx.save(); ctx.translate(canvas.width,0); ctx.scale(-1,1); ctx.drawImage(src,(sw-size)/2,(sh-size)/2,size,size,0,0,224,224); ctx.restore(); return canvas; }
function drawPreview(src){const pc = previewCanvas; const ctx = pc.getContext('2d'); const w = pc.clientWidth || 320; const h = 180; pc.width = w; pc.height = h; ctx.save(); ctx.translate(w,0); ctx.scale(-1,1); ctx.drawImage(src,0,0,w,h); ctx.restore(); }
function cToF(c){ return Math.round((c*9/5 + 32)*10)/10; }
const preservation = {'Ceramic':[10,20],'Glass':[8,18],'Metal':[5,15],'Wood':[12,20],'Stone':[5,20],'Paper':[15,20],'Textile':[10,18],'Leather':[10,18],'Plastic':[10,20],'Unknown':[15,20]};
function pickTempF(label){const r = preservation[label] || preservation['Unknown']; const mid=(r[0]+r[1])/2; return mid; }
shutterBtn.addEventListener('click', async ()=>{ if(!tmModel){ alert('Model not ready'); return } try{ shutterBtn.style.pointerEvents='none'; setProg(20); stepInfo.textContent='Capturing image'; const canvas = drawToCanvas(video, proc); drawPreview(canvas); setProg(45); stepInfo.textContent='Predicting'; const preds = await tmModel.predict(canvas); if(!preds || preds.length===0) throw new Error('no predictions'); preds.sort((a,b)=>b.probability - a.probability); const top = preds[0]; materialVal.textContent = top.className; predicted.textContent = top.className; idealTemp.textContent = pickTempF(top.className) + ' °C'; reasonEl.textContent = 'Top score: ' + Math.round(top.probability*100) + '%'; resultCard.style.display = 'block'; setProg(100); await new Promise(r=>setTimeout(r,300)); setProg(0); } catch(e){ console.error(e); stepInfo.textContent='Prediction failed'; alert('Prediction failed — see console'); } finally { shutterBtn.style.pointerEvents='auto' } });
flipBtn.addEventListener('click', async ()=>{ try{ const settings = stream && stream.getVideoTracks()[0] && stream.getVideoTracks()[0].getSettings(); const current = settings && settings.facingMode === 'user'; await startCamera(current ? 'environment' : 'user'); }catch(e){ await startCamera() } });
fileInput.addEventListener('change', async (ev)=>{ const f = ev.target.files[0]; if(!f) return; const url = URL.createObjectURL(f); const img = new Image(); img.onload = async ()=>{ drawPreview(img); const canvas = document.createElement('canvas'); const size = Math.min(img.naturalWidth || img.width, img.naturalHeight || img.height); canvas.width = 224; canvas.height = 224; const ctx = canvas.getContext('2d'); ctx.drawImage(img,(img.naturalWidth - size)/2,(img.naturalHeight - size)/2,size,size,0,0,224,224); setProg(30); stepInfo.textContent='Predicting uploaded image'; try{ const preds = await tmModel.predict(canvas); preds.sort((a,b)=>b.probability - a.probability); const top = preds[0]; materialVal.textContent = top.className; predicted.textContent = top.className; idealTemp.textContent = pickTempF(top.className) + ' °F'; reasonEl.textContent = 'Top score: ' + Math.round(top.probability*100) + '%'; resultCard.style.display = 'block'; }catch(e){ console.error(e); stepInfo.textContent='Prediction failed' } setProg(100); setTimeout(()=>setProg(0),300); }; img.src = url; });
saveBtn.addEventListener('click', ()=>{ const pc = previewCanvas; if(!pc.width) return; const a = document.createElement('a'); a.href = pc.toDataURL('image/jpeg',0.9); a.download = 'capture.jpg'; a.click(); });
window.addEventListener('load', async ()=>{ await startCamera(); await loadModel(); });
const bg = document.getElementById('bgCanvas'); const ctx = bg.getContext('2d'); let W = innerWidth, H = innerHeight, dots = []; function resizeBg(){ W = innerWidth; H = innerHeight; bg.width = W; bg.height = H; dots = []; for(let i=0;i<140;i++) dots.push({x:Math.random()*W, y:Math.random()*H, r:Math.random()*1.8+0.6, vy:Math.random()*0.35+0.05, alpha:Math.random()*0.35+0.05, phase:Math.random()*Math.PI*2}); } resizeBg(); addEventListener('resize', resizeBg); function drawBg(){ ctx.clearRect(0,0,W,H); const t = performance.now()/1000; for(const d of dots){ d.y -= d.vy + Math.sin(t + d.phase)*0.2; if(d.y < -10) d.y = H + 10; ctx.beginPath(); ctx.ellipse(d.x, d.y, d.r*2, d.r, 0, 0, Math.PI*2); ctx.fillStyle = 'rgba(10,132,255,' + (d.alpha*0.08) + ')'; ctx.fill(); } requestAnimationFrame(drawBg); } drawBg();
</script>
</body>
</html>

